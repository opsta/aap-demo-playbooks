<!DOCTYPE html>
<html>
<head>
<style>
#vms {
  font-family: Arial, Helvetica, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

#vms td, #vms th {
  border: 1px solid #ddd;
  padding: 8px;
}

#vms tr:nth-child(even){background-color: #f2f2f2;}

#vms tr:hover {background-color: #ddd;}

#vms th {
  padding-top: 12px;
  padding-bottom: 12px;
  text-align: left;
  background-color: #04AA6D;
  color: white;
}
</style>
</head>
<body>

<h1>Virtual Machines Inventory Report</h1>

<table id="vms">
  <tr>
    <th>No.</th>
    <th>Hostname</th>
    <th>IPs</th>
    <th>Devices</th>
    <th>OS</th>
    <th>Kernel Version</th>
    <th>vCPUs</th>
    <th>Memory</th>
    <th>Disk</th>
    <th>Last Update</th>
  </tr>

  {% for host in hostvars %}
  <tr>
    <td>{{ loop.index }}</td>
    <td>{{ hostvars[loop.index].ansible_hostname }}</td>
    <td>{{ hostvars[loop.index].ansible_all_ipv4_addresses | join(", ") }}</td>
    <td>
    {% for device in hostvars[loop.index].ansible_devices|dict2items %}
      {% if device.key.startswith('loop') is not true %}
      {{ device.key }} has {{ device.value['size'] }}<br/>
      {% endif %}
    {% endfor %}
    </td>
    <td>{{ hostvars[loop.index].ansible_distribution }} {{ ansible_distribution_version }}</td>
    <td>{{ hostvars[loop.index].ansible_kernel }}</td>
    <td>{{ hostvars[loop.index].ansible_processor_vcpus }}</td>
    <td>{{ '%.2f' | format(hostvars[loop.index].ansible_memtotal_mb/1024) }}GB</td>
    <td>
    {% for mount in hostvars[loop.index].ansible_mounts %}
      {% if mount['device'].startswith('/dev/loop') is not true %}
      {{ mount['device'] }} mount at {{ mount['mount'] }} uses {{ '%.2f' | format(mount['size_available']/1024/1024/1024) }}GB of {{ '%.2f' | format(mount['size_total']/1024/1024/1024) }}GB<br/>
      {% endif %}
    {% endfor %}
    </td>
    <td>{{ hostvars[loop.index].ansible_date_time['iso8601'] }}</td>
  </tr>
  {% endfor %}

</table>

</body>
</html>
